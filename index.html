<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Live Health Monitor</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #45b1e7;
      --primary-dark: #3592bb;
      --bg: #f9fbfd;
      --card-bg: #fff;
      --accent: #fbbc05;
      --alert: #f44336;
      --border-radius: 16px;
      --shadow: 0 6px 24px rgba(69, 177, 231, 0.08), 0 1.5px 4px rgba(0,0,0,0.03);
      --text-main: #222;
      --text-light: #586377;
    }
    html, body { height: 100%; margin: 0; box-sizing: border-box; }
    body {
      font-family: 'Montserrat', Arial, sans-serif;
      background: linear-gradient(120deg, #f9fbfd 70%, #e6f2fb 100%);
      min-height: 100vh;
      color: var(--text-main);
      padding: 0;
    }
    header {
      background: linear-gradient(90deg, var(--primary) 60%, var(--primary-dark) 100%);
      color: white;
      padding: 32px 0 24px 0;
      border-radius: 0 0 var(--border-radius) var(--border-radius);
      box-shadow: var(--shadow);
      text-align: center;
    }
    header h1 {
      margin: 0 0 8px 0;
      font-weight: 700;
      font-size: 2.2rem;
      letter-spacing: 1px;
    }
    header p {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 400;
      color: #e1f4fc;
    }
    .dashboard {
      max-width: 1100px;
      margin: -48px auto 0 auto;
      padding: 0 20px 40px 20px;
    }
    .live-section {
      display: flex;
      flex-wrap: wrap;
      gap: 28px;
      justify-content: center;
      margin-bottom: 44px;
      margin-top: 32px;
    }
    .live-card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 32px 40px;
      min-width: 220px;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      transition: box-shadow 0.3s;
    }
    .live-icon {
      font-size: 2.6rem;
      margin-bottom: 8px;
      color: var(--primary);
      filter: drop-shadow(0 1px 1px #b2e1fa);
    }
    .live-value {
      font-size: 2.7rem;
      font-weight: 700;
      margin-bottom: 0px;
      color: var(--accent);
      letter-spacing: 2px;
    }
    .live-label {
      font-size: 1rem;
      color: var(--text-light);
      font-weight: 400;
      letter-spacing: 1px;
    }
    .sos-alert {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(244,67,54,0.94);
      color: white; display: flex; align-items: center; justify-content: center;
      font-size: 2.6rem; font-weight: bold; z-index: 9999;
      animation: flash 1s infinite;
      letter-spacing: 2px;
      text-shadow: 0 2px 8px #c62828, 0 1px 0 #fff;
      flex-direction: column;
    }
    .sos-alert small {
      font-size: 1.1rem;
      font-weight: 400;
      color: #ffe3e3;
      margin-top: 14px;
    }
    .sos-ack-btn {
      margin-top: 2rem;
      padding: 0.8rem 2.5rem;
      font-size: 1.3rem;
      background: #fff;
      color: #d32f2f;
      border: none;
      border-radius: 10px;
      font-weight: 700;
      letter-spacing: 1px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      transition: background 0.2s, color 0.2s;
    }
    .sos-ack-btn:hover {
      background: #f6c3c3;
      color: #b71c1c;
    }
    @keyframes flash {
      0% { opacity: 1; }
      50% { opacity: 0.6; }
      100% { opacity: 1; }
    }
    .footer {
      text-align: center;
      padding: 28px 0 10px 0;
      color: #9db5c8;
      font-size: 1rem;
      background: none;
      letter-spacing: 1px;
      margin-top: 36px;
    }
    .footer a { color: var(--primary-dark); text-decoration: none; font-weight: bold; }
    ::selection { background: #b6e6ff; }
  </style>
</head>
<body>
  <header>
    <h1>Live Health Monitor</h1>
    <p>Track your vital signs in real time. Stay informed, stay safe.</p>
  </header>
  <div id="sosBanner" class="sos-alert" style="display:none;">
    üö® SOS TRIGGERED! üö®
    <small>Immediate attention required.</small>
    <button class="sos-ack-btn" onclick="ackSos()">Respond</button>
  </div>
  <main class="dashboard">
    <section class="live-section">
      <div class="live-card" style="--color: #fbbc05;">
        <span class="live-icon">üå°Ô∏è</span>
        <span id="live-temp" class="live-value">-- ¬∞C</span>
        <span class="live-label">Temperature</span>
      </div>
      <div class="live-card" style="--color: #45b1e7;">
        <span class="live-icon">‚ù§Ô∏è</span>
        <span id="live-bpm" class="live-value">--</span>
        <span class="live-label">Heart Rate (BPM)</span>
      </div>
      <div class="live-card" style="--color: #4caf50;">
        <span class="live-icon">ü´Å</span>
        <span id="live-co2" class="live-value">-- %</span>
        <span class="live-label">sCO‚ÇÇ (%)</span>
      </div>
    </section>
  </main>
  <footer class="footer">
    Inspired by leading health apps. &copy; 2025 <a href="#">HealthMonitor</a>
  </footer>
  <audio id="sos-audio" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDssbC1dIiDmACxzSs9Kn-vA-cRT3MLKzk",
      authDomain: "healthmonitorapp-47655.firebaseapp.com",
      databaseURL: "https://healthmonitorapp-47655-default-rtdb.firebaseio.com",
      projectId: "healthmonitorapp-47655",
      storageBucket: "healthmonitorapp-47655.appspot.com",
      messagingSenderId: "831668449943",
      appId: "1:831668449943:web:b9ae8fdd50de8fc4d2efd2",
      measurementId: "G-BPCV50PSCF"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let sosKey = null;
    let sosActive = false;
    let sosAudioInterval = null;

    // Play SOS audio in a loop
    function playSosAudio() {
      const audio = document.getElementById('sos-audio');
      if (!audio) return;
      audio.currentTime = 0;
      audio.play();
      // Restart audio after it ends to keep ringing
      sosAudioInterval = setInterval(() => {
        if (!sosActive) return;
        audio.currentTime = 0;
        audio.play();
      }, 3000); // Alarm is ~2.5s, so this keeps it ringing
    }

    function stopSosAudio() {
      const audio = document.getElementById('sos-audio');
      if (!audio) return;
      audio.pause();
      audio.currentTime = 0;
      if (sosAudioInterval) clearInterval(sosAudioInterval);
      sosAudioInterval = null;
    }

    // Live value update and SOS
    db.ref('readings').limitToLast(1).on('value', snap => {
      if (!snap.exists()) return;
      let lastData, lastKey;
      snap.forEach(child => { lastData = child.val(); lastKey = child.key; });
      if (!lastData) return;
      document.getElementById('live-temp').textContent = (lastData.temp ? lastData.temp : "--") + " ¬∞C";
      document.getElementById('live-bpm').textContent = lastData.bpm ? lastData.bpm : "--";
      document.getElementById('live-co2').textContent = (lastData.sco2 ? lastData.sco2 : "--") + " %";
      sosKey = lastKey;
      if (lastData.sos === true && lastData.sos_ack !== true) {
        showSOS();
      } else {
        hideSOS();
      }
    });

    function showSOS() {
      document.getElementById('sosBanner').style.display = 'flex';
      if (!sosActive) {
        sosActive = true;
        playSosAudio();
      }
    }
    function hideSOS() {
      document.getElementById('sosBanner').style.display = 'none';
      sosActive = false;
      stopSosAudio();
    }
    window.ackSos = async function() {
      if (sosKey) {
        await db.ref('readings/' + sosKey).update({ sos_ack: true, sos: false });
        hideSOS();
      }
    };
  </script>
</body>
</html>
